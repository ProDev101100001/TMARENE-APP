{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user's profile information, including physical attributes, fitness goals, and preferences gathered during onboarding. This entity stores core data about the user, excluding authentication details.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserProfile entity."
        },
        "name": {
          "type": "string",
          "description": "The user's full name or display name."
        },
        "age": {
          "type": "number",
          "description": "The user's age in years."
        },
        "weightBaselineKg": {
          "type": "number",
          "description": "The user's initial weight recorded during the onboarding process, in kilograms."
        },
        "heightCm": {
          "type": "number",
          "description": "The user's height in centimeters, used for BMI calculation."
        },
        "gender": {
          "type": "string",
          "description": "The user's gender (male or female).",
          "format": "enum"
        },
        "goal": {
          "type": "string",
          "description": "The user's primary fitness goal (e.g., weight loss, muscle gain, fitness maintenance).",
          "format": "enum"
        },
        "activityLevel": {
          "type": "string",
          "description": "The user's current activity level (e.g., beginner, intermediate, advanced).",
          "format": "enum"
        },
        "preferredSports": {
          "type": "array",
          "description": "A list of sports or activities the user prefers.",
          "items": {
            "type": "string"
          }
        },
        "healthRestrictions": {
          "type": "string",
          "description": "Any health injuries or restrictions the user has, provided as free text."
        },
        "bmi": {
          "type": "number",
          "description": "The user's Body Mass Index (BMI), calculated based on height and weight."
        },
        "tdeeCalories": {
          "type": "number",
          "description": "The user's estimated Total Daily Energy Expenditure (TDEE), representing ideal daily calorie intake."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the user profile was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the user profile was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "age",
        "weightBaselineKg",
        "heightCm",
        "gender",
        "goal",
        "activityLevel",
        "bmi",
        "tdeeCalories",
        "createdAt",
        "updatedAt"
      ]
    },
    "DailyLog": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DailyLog",
      "type": "object",
      "description": "Aggregates all daily health and fitness activities for a user on a specific date, including steps, meals, and workout logs.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the DailyLog entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N DailyLog)"
        },
        "date": {
          "type": "string",
          "description": "The specific date for this daily log entry (YYYY-MM-DD).",
          "format": "date"
        },
        "stepLogId": {
          "type": "string",
          "description": "Reference to the StepLog entity for this day. (Relationship: DailyLog 1:1 StepLog)"
        },
        "mealLogIds": {
          "type": "array",
          "description": "References to MealLog entities for all meals consumed on this day. (Relationship: DailyLog 1:N MealLog)",
          "items": {
            "type": "string"
          }
        },
        "workoutLogId": {
          "type": "string",
          "description": "Reference to the WorkoutLog entity if a workout was completed on this day. (Relationship: DailyLog 1:1 WorkoutLog)"
        },
        "caloriesConsumedTotal": {
          "type": "number",
          "description": "The total calories consumed by the user on this day, aggregated from all meals."
        },
        "caloriesBurnedTotal": {
          "type": "number",
          "description": "The total calories burned by the user on this day, aggregated from steps and workouts."
        },
        "proteinConsumedGrams": {
          "type": "number",
          "description": "The total protein consumed by the user on this day, in grams."
        },
        "carbsConsumedGrams": {
          "type": "number",
          "description": "The total carbohydrates consumed by the user on this day, in grams."
        },
        "fatsConsumedGrams": {
          "type": "number",
          "description": "The total fats consumed by the user on this day, in grams."
        }
      },
      "required": [
        "id",
        "userId",
        "date",
        "stepLogId",
        "mealLogIds",
        "caloriesConsumedTotal",
        "caloriesBurnedTotal",
        "proteinConsumedGrams",
        "carbsConsumedGrams",
        "fatsConsumedGrams"
      ]
    },
    "StepLog": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "StepLog",
      "type": "object",
      "description": "Detailed log of a user's daily steps, distance, calories burned, and recorded route.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the StepLog entity."
        },
        "dailyLogId": {
          "type": "string",
          "description": "Reference to the DailyLog entity this step log belongs to. (Relationship: DailyLog 1:1 StepLog)"
        },
        "stepsCount": {
          "type": "number",
          "description": "The total number of steps recorded for the day."
        },
        "distanceKm": {
          "type": "number",
          "description": "The total distance walked/run for the day, in kilometers."
        },
        "caloriesBurned": {
          "type": "number",
          "description": "The estimated calories burned from steps and movement for the day."
        },
        "routePointsJson": {
          "type": "string",
          "description": "A JSON string representing an array of objects, where each object contains 'lat' (latitude), 'lng' (longitude), and 'timestamp' for the user's recorded route throughout the day. This is stored as a string due to schema constraints on array item types."
        },
        "dailyStepGoal": {
          "type": "number",
          "description": "The user's customizable daily step goal."
        }
      },
      "required": [
        "id",
        "dailyLogId",
        "stepsCount",
        "distanceKm",
        "caloriesBurned",
        "dailyStepGoal"
      ]
    },
    "MealLog": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "MealLog",
      "type": "object",
      "description": "Records details of a single meal consumed by the user, including an image, estimated calories, and identified food items.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the MealLog entity."
        },
        "dailyLogId": {
          "type": "string",
          "description": "Reference to the DailyLog entity this meal log belongs to. (Relationship: DailyLog 1:N MealLog)"
        },
        "timestamp": {
          "type": "string",
          "description": "The date and time when the meal was consumed.",
          "format": "date-time"
        },
        "imageUrl": {
          "type": "string",
          "description": "The URL of the photo taken for the meal.",
          "format": "uri"
        },
        "foodItemLogIds": {
          "type": "array",
          "description": "References to FoodItemLog entities identified within this meal. (Relationship: MealLog 1:N FoodItemLog)",
          "items": {
            "type": "string"
          }
        },
        "totalMealCalories": {
          "type": "number",
          "description": "The estimated total calories for the entire meal."
        },
        "isUserConfirmed": {
          "type": "boolean",
          "description": "Indicates if the meal's calorie and macro estimations were confirmed or modified by the user after AI analysis."
        }
      },
      "required": [
        "id",
        "dailyLogId",
        "timestamp",
        "imageUrl",
        "foodItemLogIds",
        "totalMealCalories",
        "isUserConfirmed"
      ]
    },
    "FoodItemLog": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "FoodItemLog",
      "type": "object",
      "description": "Represents a single food item identified within a MealLog, including its estimated portion size, calories, and macronutrients.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the FoodItemLog entity."
        },
        "mealLogId": {
          "type": "string",
          "description": "Reference to the MealLog entity this food item belongs to. (Relationship: MealLog 1:N FoodItemLog)"
        },
        "name": {
          "type": "string",
          "description": "The name of the identified food item (e.g., 'Hamburger patty', 'Lettuce')."
        },
        "estimatedPortionSizeGrams": {
          "type": "number",
          "description": "The estimated portion size of the food item in grams."
        },
        "calories": {
          "type": "number",
          "description": "The estimated calories for this specific food item."
        },
        "proteinGrams": {
          "type": "number",
          "description": "The estimated protein content of the food item in grams."
        },
        "carbsGrams": {
          "type": "number",
          "description": "The estimated carbohydrate content of the food item in grams."
        },
        "fatsGrams": {
          "type": "number",
          "description": "The estimated fat content of the food item in grams."
        },
        "isUserModified": {
          "type": "boolean",
          "description": "Indicates if the user has manually modified the AI's estimation for this food item."
        }
      },
      "required": [
        "id",
        "mealLogId",
        "name",
        "estimatedPortionSizeGrams",
        "calories",
        "proteinGrams",
        "carbsGrams",
        "fatsGrams",
        "isUserModified"
      ]
    },
    "WorkoutProgram": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "WorkoutProgram",
      "type": "object",
      "description": "Defines a personalized multi-day workout program (e.g., 30 days) generated for a user based on their onboarding data.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the WorkoutProgram entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N WorkoutProgram)"
        },
        "startDate": {
          "type": "string",
          "description": "The date when the workout program officially started for the user (YYYY-MM-DD).",
          "format": "date"
        },
        "currentDayNumber": {
          "type": "number",
          "description": "The current day number the user is on in their workout program."
        },
        "workoutProgramDayIds": {
          "type": "array",
          "description": "References to WorkoutProgramDay entities that constitute this program. (Relationship: WorkoutProgram 1:N WorkoutProgramDay)",
          "items": {
            "type": "string"
          }
        },
        "durationDays": {
          "type": "number",
          "description": "The total duration of the workout program in days (e.g., 30)."
        }
      },
      "required": [
        "id",
        "userId",
        "startDate",
        "currentDayNumber",
        "workoutProgramDayIds",
        "durationDays"
      ]
    },
    "WorkoutProgramDay": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "WorkoutProgramDay",
      "type": "object",
      "description": "Represents the planned exercises and details for a specific day within a user's WorkoutProgram.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the WorkoutProgramDay entity."
        },
        "programId": {
          "type": "string",
          "description": "Reference to the WorkoutProgram this day belongs to. (Relationship: WorkoutProgram 1:N WorkoutProgramDay)"
        },
        "dayNumber": {
          "type": "number",
          "description": "The sequential day number within the overall workout program (e.g., Day 1, Day 2)."
        },
        "workoutProgramDayExerciseIds": {
          "type": "array",
          "description": "References to WorkoutProgramDayExercise entities, detailing the specific exercises and parameters for this day. (Relationship: WorkoutProgramDay 1:N WorkoutProgramDayExercise)",
          "items": {
            "type": "string"
          }
        },
        "motivationalNote": {
          "type": "string",
          "description": "A motivational note or tip for the user for this specific workout day."
        }
      },
      "required": [
        "id",
        "programId",
        "dayNumber",
        "workoutProgramDayExerciseIds"
      ]
    },
    "Exercise": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Exercise",
      "type": "object",
      "description": "Defines a generic exercise with its name, description, and visual aids, acting as a template for specific workout routines.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Exercise entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the exercise (e.g., 'Squat', 'Plank')."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of how to perform the exercise correctly."
        },
        "videoUrl": {
          "type": "string",
          "description": "URL to a video demonstrating the exercise.",
          "format": "uri"
        },
        "imageUrl": {
          "type": "string",
          "description": "URL to an image illustrating the exercise.",
          "format": "uri"
        },
        "category": {
          "type": "string",
          "description": "The category of the exercise (e.g., 'legs', 'core', 'upperBody')."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "category"
      ]
    },
    "WorkoutProgramDayExercise": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "WorkoutProgramDayExercise",
      "type": "object",
      "description": "Specifies the details (sets, reps/duration, rest time) for a particular exercise as it appears within a WorkoutProgramDay.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the WorkoutProgramDayExercise entity."
        },
        "workoutProgramDayId": {
          "type": "string",
          "description": "Reference to the WorkoutProgramDay this exercise configuration belongs to. (Relationship: WorkoutProgramDay 1:N WorkoutProgramDayExercise)"
        },
        "exerciseId": {
          "type": "string",
          "description": "Reference to the generic Exercise entity being performed. (Relationship: Exercise 1:N WorkoutProgramDayExercise)"
        },
        "sets": {
          "type": "number",
          "description": "The number of sets for this exercise on this day."
        },
        "repsOrDurationSeconds": {
          "type": "number",
          "description": "The number of repetitions or duration in seconds for each set of the exercise."
        },
        "restTimeSeconds": {
          "type": "number",
          "description": "The recommended rest time between sets in seconds."
        },
        "orderIndex": {
          "type": "number",
          "description": "The sequential order of this exercise within the workout day."
        }
      },
      "required": [
        "id",
        "workoutProgramDayId",
        "exerciseId",
        "sets",
        "repsOrDurationSeconds",
        "restTimeSeconds",
        "orderIndex"
      ]
    },
    "WorkoutLog": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "WorkoutLog",
      "type": "object",
      "description": "Logs the completion status and duration of a user's workout for a specific day.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the WorkoutLog entity."
        },
        "dailyLogId": {
          "type": "string",
          "description": "Reference to the DailyLog entity this workout log belongs to. (Relationship: DailyLog 1:1 WorkoutLog)"
        },
        "workoutProgramDayId": {
          "type": "string",
          "description": "Reference to the specific WorkoutProgramDay that was attempted or completed. (Relationship: WorkoutProgramDay 1:N WorkoutLog)"
        },
        "isCompleted": {
          "type": "boolean",
          "description": "Indicates whether the workout for the day was completed."
        },
        "completionDurationMinutes": {
          "type": "number",
          "description": "The actual duration it took the user to complete the workout, in minutes."
        },
        "completedAt": {
          "type": "string",
          "description": "Timestamp when the workout was marked as completed.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "dailyLogId",
        "workoutProgramDayId",
        "isCompleted",
        "completionDurationMinutes",
        "completedAt"
      ]
    },
    "WeightEntry": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "WeightEntry",
      "type": "object",
      "description": "Records a user's actual weight on a specific date, typically updated weekly, to track progress over time.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the WeightEntry entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N WeightEntry)"
        },
        "date": {
          "type": "string",
          "description": "The date when the weight was recorded (YYYY-MM-DD).",
          "format": "date"
        },
        "weightKg": {
          "type": "number",
          "description": "The user's recorded weight in kilograms."
        },
        "isBaseline": {
          "type": "boolean",
          "description": "Indicates if this weight entry is the initial baseline weight recorded during onboarding."
        }
      },
      "required": [
        "id",
        "userId",
        "date",
        "weightKg",
        "isBaseline"
      ]
    },
    "AIChatInteraction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AIChatInteraction",
      "type": "object",
      "description": "Stores a conversation interaction between the user and the AI Health Assistant, capturing the messages and relevant context.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the AIChatInteraction entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N AIChatInteraction)"
        },
        "timestamp": {
          "type": "string",
          "description": "The date and time of the interaction.",
          "format": "date-time"
        },
        "userMessage": {
          "type": "string",
          "description": "The message sent by the user to the AI assistant."
        },
        "aiResponse": {
          "type": "string",
          "description": "The response generated by the AI assistant."
        },
        "relevantContextJson": {
          "type": "string",
          "description": "A JSON string containing relevant user data (e.g., current daily calories, goals) that was used to inform the AI's response. Stored as a string to adhere to schema constraints on nested object types within arrays."
        },
        "responseType": {
          "type": "string",
          "description": "Categorization of the AI's response (e.g., 'advice', 'information', 'warning')."
        }
      },
      "required": [
        "id",
        "userId",
        "timestamp",
        "userMessage",
        "aiResponse",
        "relevantContextJson",
        "responseType"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/profile_data",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores the user's profile information. This is a 1:1 subcollection where the document ID matches the userId, ensuring direct ownership. The 'id' field within the document is redundant as the userId in the path handles authorization.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the authenticated user. This ID is used for authorization and path-based security."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/dailyLogs/{dailyLogDate}",
        "definition": {
          "entityName": "DailyLog",
          "schema": {
            "$ref": "#/backend/entities/DailyLog"
          },
          "description": "Aggregates all daily health and fitness activities for a user. Document IDs are in YYYY-MM-DD format for easy date-based querying. The 'userId' and 'id' fields in the document are implicitly handled by the path and document ID for authorization and identification.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user who owns this daily log."
            },
            {
              "name": "dailyLogDate",
              "description": "The specific date for this daily log entry (YYYY-MM-DD), serving as the document ID."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/dailyLogs/{dailyLogDate}/stepLog_data",
        "definition": {
          "entityName": "StepLog",
          "schema": {
            "$ref": "#/backend/entities/StepLog"
          },
          "description": "Detailed log of a user's daily steps, distance, and calories burned for a specific date. This is a 1:1 subcollection, where the document ID typically matches the dailyLogDate. The 'dailyLogId' and 'id' fields in the document are redundant as path and document ID provide context.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "dailyLogDate",
              "description": "The specific date for the daily log entry."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/dailyLogs/{dailyLogDate}/mealLogs/{mealLogId}",
        "definition": {
          "entityName": "MealLog",
          "schema": {
            "$ref": "#/backend/entities/MealLog"
          },
          "description": "Records details of a single meal consumed by the user on a given day. The 'dailyLogId' field in the document is redundant due to the path. 'id' field matches mealLogId.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "dailyLogDate",
              "description": "The specific date for the daily log entry."
            },
            {
              "name": "mealLogId",
              "description": "The unique identifier for the specific meal log."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/dailyLogs/{dailyLogDate}/mealLogs/{mealLogId}/foodItemLogs/{foodItemLogId}",
        "definition": {
          "entityName": "FoodItemLog",
          "schema": {
            "$ref": "#/backend/entities/FoodItemLog"
          },
          "description": "Represents a single food item identified within a MealLog. The 'mealLogId' and 'id' fields in the document are redundant due to the path and document ID.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "dailyLogDate",
              "description": "The specific date for the daily log entry."
            },
            {
              "name": "mealLogId",
              "description": "The unique identifier for the specific meal log."
            },
            {
              "name": "foodItemLogId",
              "description": "The unique identifier for the specific food item log."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/workoutPrograms/{programId}",
        "definition": {
          "entityName": "WorkoutProgram",
          "schema": {
            "$ref": "#/backend/entities/WorkoutProgram"
          },
          "description": "Defines a personalized multi-day workout program for a user. The 'userId' and 'id' fields in the document are redundant due to the path and document ID.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user who owns this workout program."
            },
            {
              "name": "programId",
              "description": "The unique identifier for the workout program."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/workoutPrograms/{programId}/workoutProgramDays/{programDayId}",
        "definition": {
          "entityName": "WorkoutProgramDay",
          "schema": {
            "$ref": "#/backend/entities/WorkoutProgramDay"
          },
          "description": "Represents the planned exercises and details for a specific day within a user's WorkoutProgram. The 'programId' and 'id' fields in the document are redundant due to the path and document ID.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "programId",
              "description": "The unique identifier for the parent workout program."
            },
            {
              "name": "programDayId",
              "description": "The unique identifier for this specific day within the workout program."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/workoutPrograms/{programId}/workoutProgramDays/{programDayId}/programDayExercises/{programDayExerciseId}",
        "definition": {
          "entityName": "WorkoutProgramDayExercise",
          "schema": {
            "$ref": "#/backend/entities/WorkoutProgramDayExercise"
          },
          "description": "Specifies the details for an exercise within a WorkoutProgramDay. The 'workoutProgramDayId' and 'id' fields in the document are redundant due to the path and document ID.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "programId",
              "description": "The unique identifier for the parent workout program."
            },
            {
              "name": "programDayId",
              "description": "The unique identifier for the parent workout program day."
            },
            {
              "name": "programDayExerciseId",
              "description": "The unique identifier for this specific exercise configuration within the program day."
            }
          ]
        }
      },
      {
        "path": "/exercises/{exerciseId}",
        "definition": {
          "entityName": "Exercise",
          "schema": {
            "$ref": "#/backend/entities/Exercise"
          },
          "description": "Defines a generic exercise template. This is a global, read-only collection accessible to all authenticated users. The 'id' field matches exerciseId.",
          "params": [
            {
              "name": "exerciseId",
              "description": "The unique identifier for the generic exercise template."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/dailyLogs/{dailyLogDate}/workoutLog_data",
        "definition": {
          "entityName": "WorkoutLog",
          "schema": {
            "$ref": "#/backend/entities/WorkoutLog"
          },
          "description": "Logs the completion status and duration of a user's workout for a specific day. This is a 1:1 subcollection, where the document ID typically matches the dailyLogDate. The 'dailyLogId' and 'id' fields in the document are redundant due to path and document ID.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "dailyLogDate",
              "description": "The specific date for the daily log entry."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/weightEntries/{weightEntryId}",
        "definition": {
          "entityName": "WeightEntry",
          "schema": {
            "$ref": "#/backend/entities/WeightEntry"
          },
          "description": "Records a user's actual weight on a specific date. The 'userId' and 'id' fields in the document are redundant due to the path and document ID.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "weightEntryId",
              "description": "The unique identifier for the specific weight entry."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/aiChatInteractions/{chatInteractionId}",
        "definition": {
          "entityName": "AIChatInteraction",
          "schema": {
            "$ref": "#/backend/entities/AIChatInteraction"
          },
          "description": "Stores a conversation interaction between the user and the AI Health Assistant. The 'userId' and 'id' fields in the document are redundant due to the path and document ID.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "chatInteractionId",
              "description": "The unique identifier for the AI chat interaction."
            }
          ]
        }
      }
    ],
    "reasoning": "The recommended Firestore data structure for the 'Tamareeni' application prioritizes **Authorization Independence** and **Structural Segregation** to ensure security, scalability, and debuggability. All user-specific data is encapsulated within the `/users/{userId}` top-level collection, with the `userId` directly extracted from `request.auth.uid`. This design inherently eliminates the need for `get()` calls in security rules to determine ownership or permissions, as the owner's UID is always part of the document's path.\n\n**Authorization Independence (Denormalization Strategy):**\nBy nesting all personal data under `/users/{userId}/...`, the `userId` in the path serves as the primary authorization context. For instance, a user's daily log is at `/users/{userId}/dailyLogs/{dailyLogDate}`, and their profile is at `/users/{userId}/profile_data`. Any access to these documents automatically checks if `request.auth.uid == userId`. This means no additional denormalization of owner IDs or membership maps is strictly required within the documents themselves for access control, as the path provides the necessary authorization context atomically. This also simplifies atomic operations (transactions/batches) as rule evaluation doesn't depend on external document reads.\n\n**QAPs (Rules are not Filters) and Structural Segregation:**\n1.  **User-Private Data:** All collections nested under `/users/{userId}` (e.g., `dailyLogs`, `mealLogs`, `workoutPrograms`, `weightEntries`, `aiChatInteractions`, `profile_data`) are intrinsically private. Security rules can simply enforce `allow read, write: if request.auth.uid == userId;`. This ensures that `list` operations on these collections (e.g., fetching all `dailyLogs` for a user) automatically and securely retrieve only the current user's data, as the `userId` in the path is constrained by the authenticated user's ID. This directly supports the QAPs principle by ensuring that client-side queries for a user's data will only ever return data the user is authorized to see, without requiring server-side filtering.\n2.  **Global Data:** The `/exercises` collection is a top-level collection designed for global, read-only data. It segregates generic exercise templates from user-specific workout plans. Security rules can allow `read` access to all authenticated users (`allow read: if request.auth != null;`) without concerns about data privacy, as it contains no sensitive user information. This segregation ensures a homogeneous security posture for all documents within this collection, simplifying rules and client-side access patterns.\n\n**Key Structural Decisions:**\n*   **User Profile and Daily Logs:** `UserProfile` is stored as a single document in `/users/{userId}/profile_data` (document ID `userId`). `DailyLog` documents use the `dailyLogDate` (YYYY-MM-DD) as their ID for efficient date-based lookups within the `dailyLogs` subcollection. Sub-entities like `StepLog` and `WorkoutLog` are 1:1 with `DailyLog` and are stored as single documents in dedicated subcollections (`stepLog_data`, `workoutLog_data`) under their respective `dailyLogDate`, using the `dailyLogDate` as their document ID as well.\n*   **Nested Hierarchies:** Deep nesting is utilized for `MealLog` -> `FoodItemLog` and `WorkoutProgram` -> `WorkoutProgramDay` -> `WorkoutProgramDayExercise` to maintain clear ownership and contextual relationships, making rules more explicit and intuitive.\n*   **Read-Only Global Entities:** The `Exercise` entity is a global collection, `/exercises/{exerciseId}`, accessible to all authenticated users, acting as a reference catalog for workout programs."
  }
}